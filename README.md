# Next.js 15 + Capacitor Mobile App

## Overview

This project transforms a modern **Next.js 15** web application into a cross-platform mobile app using [Capacitor](https://capacitorjs.com/).  
Capacitor enables you to run your web app natively on **Android** and **iOS**, access device APIs, and distribute via app stores.  
Optionally, you can extend it to **Windows/macOS** using Electron or Tauri.

---

## Tech Stack

- **Next.js 15** (App Router, static export)
- **Capacitor 6**
- **Android Studio** (for Android)
- **TypeScript**
- **Tailwind CSS**

---

## Project Structure

```
/apps/web         # Next.js web app (main source)
/android          # Android native project (generated by Capacitor)
/ios              # iOS native project (generated by Capacitor)
/apps/desktop     # (optional) Desktop app (Electron/Tauri)
```

---

## Build Requirements

- **Node.js** â‰¥ 18  
- **pnpm** â‰¥ 8  
- **Capacitor CLI**  
  ```bash
  npm install -g @capacitor/cli
  ```
- **Android Studio** (for Android builds)  

---

## Setup Instructions

### 1. Install dependencies

```bash
pnpm install
```

---

### 2. Configure Next.js for Static Export

Capacitor only supports static web builds.  
Make sure your `next.config.ts` includes:

```ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  output: "export",
  basePath: "",
  assetPrefix: "./",
  trailingSlash: true,
  images: {
    remotePatterns: [
      {
        protocol: "https",
        hostname: "cdn.dummyjson.com",
      },
    ],
    unoptimized: true,
  },
  eslint: {
    ignoreDuringBuilds: true,
  },
  typescript: {
    ignoreBuildErrors: true,
  },
  experimental: {
    optimizeCss: false,
  },
  distDir: "out",
};

export default nextConfig;
```

Then build:

```bash
pnpm run build:web
```

This generates your static site inside `/apps/web/out`.

---

### 3. Initialize Capacitor

If this is your first Capacitor setup, initialize inside your web directory:

```bash
cd apps/web
npx cap init "App Name" "com.app.tu"
```

Then edit the generated `capacitor.config.ts`:

```ts
import { CapacitorConfig } from '@capacitor/cli';

const config: CapacitorConfig = {
  appId: 'com.app.tu',
  appName: 'login',
  webDir: 'out',          // must match Next.js build output folder
};

export default config;
```

If your output folder is in another path (e.g. `../web/out`), update `webDir` accordingly.

---

### 4. Add Platforms and Sync Web Build

```bash
# Add platforms
npx cap add android
npx cap add ios

# Sync web build
npx cap sync android
npx cap sync ios
```

---

### 5. Open Native Projects

```bash
npx cap open android
# or
npx cap open ios
```

Build and run on an emulator or physical device.

---

## Development Workflow

### ðŸ”¹ Local Development (Live Reload)

For faster iteration, you can connect your emulator to the local dev server:

```ts
// capacitor.config.ts
server: {
  url: "http://<your-local-ip>:3000",
  cleartext: true,
}
```

Then run:
```bash
pnpm run dev
npx cap copy android
npx cap open android
```

Your app will load directly from the live dev server.  
For production builds, **remove `server.url`** and rebuild.

---

### ðŸ”¹ Production Build

```bash
pnpm run build:web
npx cap sync android
npx cap open android
```

Run `npx cap sync` after installing any new plugin.

---

## Important Notes / Known Issues

- **SSR is not supported**  
  Use static export only (`output: 'export'`).  
  Disable features requiring Node.js servers such as NextAuth or API routes.

- **Asset Prefix**  
  Always set `assetPrefix: './'` to ensure assets load correctly on device.

- **Common Errors**
  - `index.html not found`: ensure `/out` folder exists after build.
  - `Unexpected token <`: usually caused by misconfigured export or missing asset prefix.

- **Folder Paths**  
  Capacitor expects your static build to live inside `webDir` (commonly `/out`).

---

## Folder Paths & Scripts

```bash

pnpm run build:web

pnpm --filter apps/web build && pnpm --filter apps/web export

npx cap add android
npx cap add ios

npx cap sync android
npx cap open android
```